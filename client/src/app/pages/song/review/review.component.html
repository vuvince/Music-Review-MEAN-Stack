<!-- src/app/pages/song/review/review.component.html -->
<!-- BASED OFF OF CODE FROM https://auth0.com/blog/real-world-angular-series-part-5/ -->
<div class="card-body pb-0">
  <h2 class="card-title text-center mb-0">Review</h2>
  <app-loading *ngIf="loading"></app-loading>
</div>
<ng-template [ngIf]="utils.isLoaded(loading)">
  <!-- Song is over -->
  <div *ngIf="songPast" class="card-body">
    <p class="lead card-text">
      You cannot Review to an song that has already ended.
    </p>
  </div>
  <ng-template [ngIf]="!songPast && reviews">
    <!-- User has Reviewed -->
    <ng-template [ngIf]="userReview">
      <ul *ngIf="!showEditForm" class="list-group list-group-flush">
        <div class="card-body">
          <p class="lead card-text">
            You responded to this song with the following information:
          </p>
        </div>
        <ul class="list-group list-group-flush">
          <li class="list-group-item">
            <strong>Name:</strong>{{ userReview.name }}
          </li>
          <li class="list-group-item">
            <strong>Attending:</strong
            >{{ utils.booleanToText(userReview.attending) }}
          </li>
          <li
            *ngIf="userReview.attending && userReview.guests"
            class="list-group-item"
          >
            <strong>Additional Guests:</strong>{{ userReview.guests }}
          </li>
          <li *ngIf="userReview.comments" class="list-group-item">
            <strong>Comments:</strong
            ><span [innerHTML]="userReview.comments"></span>
          </li>
        </ul>
        <!-- @TODO: Toggle Review form (update existing) will go here -->
      </ul>
      <div class="card-body">
        <button
          class="btn btn-info"
          [ngClass]="{ 'btn-info': !showEditForm, 'btn-warning': showEditForm }"
          (click)="toggleEditForm()"
        >
          {{ editBtnText }}
        </button>
        <!-- <app-review-form
          *ngIf="showEditForm"
          [songId]="songId"
          [review]="userReview"
          (submitReview)="onSubmitReview($song)"
        ></app-review-form> -->
      </div>
    </ng-template>
    <!-- No Review yet -->
    <div *ngIf="!userReview" class="card-body">
      <div *ngIf="!userReview" class="card-body">
        <p class="lead">Fill out the form below to respond:</p>
        <!-- @TODO: Review form (add new Review) will go here -->
      </div>
      <!-- <app-review-form
        [songId]="songId"
        (submitReview)="onSubmitReview($song)"
      ></app-review-form> -->
    </div>
  </ng-template>
  <!-- All Reviews -->
  <div class="card-body text-right">
    <section
      class="allReviews"
      *ngIf="showAllReviews"
      [@expandCollapse]
    ></section>
    <button (click)="toggleShowReviews()" class="btn btn-link btn-sm">
      {{ showReviewsText }}
    </button>
  </div>
  <section class="allReviews" *ngIf="showAllReviews">
    <div class="card-body">
      <!-- LIST OF REVIEWS -->
      <h3 class="card-title text-center">All Reviews</h3>
      <p *ngIf="!reviews.length" class="lead card-text">
        There are currently no Reviews for this song.
      </p>
    </div>
    <ul *ngIf="reviews.length" class="list-group list-group-flush">
      <li
        class="list-group-item list-group-item-success justify-content-between"
      >
        <strong>Attending</strong>
        <span class="badge badge-success badge-pill">{{ totalAttending }}</span>
      </li>
      <li
        *ngFor="let review of fs.filter(reviews, 'attending', true)"
        class="list-group-item small"
      >
        {{ review.name }} {{ utils.showPlusOnes(review.guests) }}
        <p *ngIf="auth.isAdmin && review.comments" class="d-flex w-100">
          <em [innerHTML]="review.comments"></em>
        </p>
      </li>
      <!-- CAN DELETE BELOW-->
      <li
        class="list-group-item list-group-item-danger justify-content-between"
      >
        <strong>Not Attending</strong>
        <span class="badge badge-danger badge-pill">{{
          fs.filter(reviews, "attending", false).length
        }}</span>
      </li>
      <!-- CAN DELETE^^ -->
      <li
        *ngFor="let review of fs.filter(reviews, 'attending', false)"
        class="list-group-item small"
      >
        {{ review.name }}
        <p *ngIf="auth.isAdmin && review.comments" class="d-flex w-100">
          <em [innerHTML]="review.comments"></em>
        </p>
      </li>
    </ul>
  </section>
  <!-- Error loading Reviews -->
  <div *ngIf="error" class="card-body">
    <p class="alert alert-danger">
      <strong>Oops!</strong> There was an error retrieving Reviews for this
      song.
    </p>
  </div>
</ng-template>
<!-- Footer showing # of total attending guests -->
<div class="card-footer text-right">
  <small *ngIf="totalAttending >= 0" class="text-muted"
    >{{ utils.displayCount(totalAttending) }} {{ footerTense }}</small
  >
</div>
