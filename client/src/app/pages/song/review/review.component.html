<!-- src/app/pages/song/review/review.component.html -->
<div class="card-body pb-0">
  <h2 class="card-title text-center mb-0">Review</h2>
  <app-loading *ngIf="loading"></app-loading>
</div>
<ng-template [ngIf]="utils.isLoaded(loading)">
  <!-- Song is over -->
  <div *ngIf="songPast" class="card-body">
    <p class="lead card-text">
      You cannot Review to an song that has already ended.
    </p>
  </div>
  <ng-template [ngIf]="!songPast && reviews">
    <!-- User has Reviewed -->
    <!-- Can remove -->
    <ng-template [ngIf]="userReview">
      <!-- @TODO: Toggle Review form (update existing) will go here -->
      <div class="card-body">
        <button
          class="btn btn-info"
          [ngClass]="{ 'btn-info': !showEditForm, 'btn-warning': showEditForm }"
          (click)="toggleEditForm()"
        >
          {{ editBtnText }}
        </button>
        <app-review-form
          *ngIf="showEditForm"
          [songId]="songId"
          [review]="userReview"
          (submitReview)="onSubmitReview($event)"
        ></app-review-form>
      </div>
    </ng-template>
    <!-- No Review yet -->
    <!-- ADD NG IF HERE FOR LOGGED IN -->
    <div *ngIf="!userReview && auth.loggedIn" class="card-body">
      <p class="lead">Fill out the form below to respond:</p>
      <!-- @TODO: Review form (add new Review) will go here -->
      <app-review-form
        [songId]="songId"
        (submitReview)="onSubmitReview($event)"
      ></app-review-form>
    </div>
  </ng-template>
  <!-- All Reviews -->
  <div class="card-body text-right">
    <button (click)="toggleShowReviews()" class="btn btn-link btn-sm">
      {{ showReviewsText }}
    </button>
  </div>
  <section class="allReviews" *ngIf="showAllReviews">
    <div class="card-body">
      <h3 class="card-title text-center">All Reviews</h3>
      <p *ngIf="!reviews.length" class="lead card-text">
        There are currently no Reviews for this song.
      </p>
    </div>
    <ul *ngIf="reviews.length" class="list-group list-group-flush">
      <li
        class="list-group-item list-group-item-success justify-content-between"
      >
        <strong>Average Rating</strong>
        <span class="badge badge-success badge-pill">{{ averageRating }}</span>
      </li>
      <li *ngFor="let review of reviews" class="list-group-item small">
        {{ review.name }} {{ utils.showRating(review.rating) }}
        <p *ngIf="review.comments" class="d-flex w-100">
          <em [innerHTML]="review.comments"></em>
        </p>
      </li>
    </ul>
  </section>
  <!-- Error loading Reviews -->
  <div *ngIf="error" class="card-body">
    <p class="alert alert-danger">
      <strong>Oops!</strong> There was an error retrieving Reviews for this
      song.
    </p>
  </div>
</ng-template>
<!-- Footer showing # of total reviews -->
<div class="card-footer text-right">
  <small *ngIf="totalRating >= 0" class="text-muted">{{
    utils.displayCount(totalReview)
  }}</small>
</div>
